<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Manx Loss Support (MLS) — Confidential listening for grief &amp; loss</title>
  <meta name="description" content="Free, confidential listening support for anyone on the Isle of Man grieving a person, pet or any loss. Call, email or use our form.">
  <meta name="theme-color" content="#f1f5f9">
  <meta name="author" content="Manx Loss Support">

  <!--
      Updates in this latest version:
    - Logo now in header brand area (logo.png), 
    - Donate button disabled 
    - Inline, gentle validation messages (boomer friendly) 
    - Modal robustness escape/backdrop close, focus trap, return focus, defensive JS
    - Mailto fallback for users to copy/paste box + copy button + calm status message
  -->

  <style>
    :root{
      --bg:#f8fafc;
      --surface:#ffffff;
      --text:#0f172a;
      --text-sub:#475569;
      --accent:#005eb8;
      --accent-dim:#004a92;
      --accent-pale:#e0f2fe;
      --border:#e2e8f0;
      --radius:10px;
      --shadow-sm:0 2px 8px rgba(0,0,0,.06);
      --shadow-md:0 4px 16px rgba(0,0,0,.09);
      --max-width:960px;

      --danger:#b91c1c;
      --danger-bg:#fef2f2;
      --danger-border:#fecaca;
      --disabled:#94a3b8;
      --disabled-bg:#f1f5f9;
    }

    *,*::before,*::after{box-sizing:border-box;}
    html{scroll-behavior:smooth;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-size:clamp(16px,1.05vw + .9rem,19px);
      line-height:1.62;
      color:var(--text);
      background:var(--bg);
      min-height:100vh;
    }

    a{color:var(--accent);text-decoration-thickness:1px;text-underline-offset:.18em;}
    a:hover,a:focus-visible{text-decoration-thickness:2px;}
    :focus-visible{outline:3px solid var(--accent-pale);outline-offset:2px;}

    .container{
      width:min(92%,var(--max-width));
      margin-inline:auto;
      padding-inline:1.5rem;
    }

    .skip-link{
      position:absolute;
      left:1rem; top:1rem;
      padding:.6rem .9rem;
      border-radius:8px;
      background:var(--surface);
      border:1px solid var(--border);
      box-shadow:var(--shadow-sm);
      transform:translateY(-200%);
      transition:transform .15s ease-out;
      z-index:9999;
    }
    .skip-link:focus{transform:translateY(0);}

    header.nav{
      position:sticky;
      top:0;
      z-index:40;
      background:var(--surface);
      border-bottom:1px solid var(--border);
      box-shadow:var(--shadow-sm);
    }
    .nav-inner{
      display:flex;
      flex-wrap:wrap;
      gap:1.25rem 2rem;
      align-items:center;
      justify-content:space-between;
      padding:1.0rem 0;
    }

    /* Brand + logo */
    .brand{
      display:flex;
      align-items:center;
      gap:.85rem;
      text-decoration:none;
      color:var(--text);
      min-width: 14rem;
    }
    .logo{
      width:44px;
      height:44px;
      border-radius:10px;
      display:block;
      object-fit:contain;
      background:transparent;
      flex:0 0 auto;
    }
    .brand-text{
      display:flex;
      flex-direction:column;
      line-height:1.15;
    }
    .brand-title{
      font-size:1.32rem;
      font-weight:650;
      letter-spacing:.01em;
    }
    .brand-sub{
      font-size:.82rem;
      font-weight:400;
      color:var(--text-sub);
      margin-top:.12rem;
    }

    .nav-links{
      display:flex;
      flex-wrap:wrap;
      gap:.75rem 1.25rem;
      align-items:center;
    }
    .nav-links a,.nav-links button{
      font-size:1.05rem;
      padding:.5rem .9rem;
    }

    .linkish{
      background:none;
      border:none;
      padding:0;
      font:inherit;
      color:var(--accent);
      cursor:pointer;
      text-decoration:underline;
      text-decoration-thickness:1px;
      text-underline-offset:.18em;
    }
    .linkish:hover,.linkish:focus-visible{text-decoration-thickness:2px;}

    button:not(.pill):not(.btn):not(.linkish){
      background:none;
      border:none;
      font:inherit;
      color:var(--accent);
      cursor:pointer;
    }
    button:not(.pill):not(.btn):not(.linkish):hover,
    button:not(.pill):not(.btn):not(.linkish):focus-visible{
      text-decoration:underline;
      text-decoration-thickness:2px;
      text-underline-offset:.18em;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:9rem;
      padding:.9em 1.6em;
      font-size:1.05rem;
      font-weight:600;
      line-height:1.35;
      border-radius:var(--radius);
      border:0;
      background:var(--accent);
      color:#fff;
      cursor:pointer;
      transition:background-color .18s ease-out;
      text-decoration:none;
    }
    .btn:hover{background:var(--accent-dim);}
    .btn-outline{
      background:transparent;
      border:2px solid var(--accent);
      color:var(--accent);
    }
    .btn-outline:hover{background:var(--accent-pale);}

    .btn[disabled],
    .btn.is-disabled{
      background:var(--disabled-bg);
      color:var(--disabled);
      border:2px solid var(--border);
      cursor:not-allowed;
      pointer-events:none;
    }

    main{display:block;}
    .hero{
      padding:5.2rem 0 3.3rem;
      text-align:center;
    }
    h1{
      font-size:clamp(2.6rem,6vw + 1rem,3.4rem);
      line-height:1.12;
      margin:0 0 1.2rem;
    }
    .lead{
      font-size:1.32rem;
      color:var(--text-sub);
      max-width:42rem;
      margin:0 auto 1.1rem;
    }
    .intro-nudge{
      font-size:1.08rem;
      color:var(--text-sub);
      max-width:44rem;
      margin:0 auto 1.2rem;
    }
    .phone-nudge{
      font-size:1.02rem;
      color:var(--text-sub);
      max-width:44rem;
      margin:0 auto 1.4rem;
    }
    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:1rem;
      justify-content:center;
      margin:1.6rem 0 2.2rem;
    }
    .alert{
      background:#fffbeb;
      border:1px solid #fde68a;
      border-radius:var(--radius);
      padding:1.25rem 1.5rem;
      margin:1.6rem 0;
      font-size:1.05rem;
      text-align:left;
    }

    section{padding:4.5rem 0;}
    .tiles{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:1.5rem;
      margin:2.5rem 0;
      padding:0;
    }
    .tile{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:1.8rem 1.5rem;
      box-shadow:var(--shadow-sm);
      text-align:center;
    }
    .tile h3{margin:0 0 .9rem;font-size:1.32rem;}
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:11rem;
      padding:.9em 1.8em;
      margin:.8rem 0;
      font-size:1.18rem;
      font-weight:600;
      border-radius:999px;
      background:var(--accent);
      color:#fff;
      border:0;
      cursor:pointer;
      text-decoration:none;
      transition:background-color .18s ease-out;
    }
    .pill:hover{background:var(--accent-dim);}

    h2.section-label{
      font-size:.94rem;
      font-weight:600;
      color:var(--text-sub);
      text-transform:uppercase;
      letter-spacing:.06em;
      text-align:center;
      margin:0 0 1.4rem;
    }

    .grid-2-3{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:1.6rem;
    }
    .card{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:1.8rem;
      box-shadow:var(--shadow-sm);
    }
    .card h3{margin:0 0 1rem;font-size:1.38rem;}

    .donate-title{
      font-size:1.9rem;
      margin:0 0 .9rem;
      line-height:1.15;
    }

    .field-hint{
      margin:.5rem 0 0;
      color:var(--text-sub);
      font-size:.96rem;
    }
    .callout{
      background:#f1f5f9;
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:1rem 1.2rem;
      color:var(--text-sub);
      font-size:1rem;
      line-height:1.6;
    }

    footer{
      border-top:1px solid var(--border);
      background:var(--surface);
      padding:3rem 0 2.5rem;
      color:var(--text-sub);
      font-size:.96rem;
      text-align:center;
      line-height:1.7;
    }

    /* ── Inline errors ───────────── */
    .error{
      margin:.55rem 0 0;
      padding:.6rem .75rem;
      border-radius:8px;
      background:var(--danger-bg);
      border:1px solid var(--danger-border);
      color:var(--danger);
      font-size:.98rem;
      line-height:1.45;
      display:none;
    }
    .has-error .error{display:block;}
    .has-error input,
    .has-error select,
    .has-error textarea{
      border-color:var(--danger-border);
      box-shadow:0 0 0 3px rgba(185,28,28,0.10);
    }

    /* ── Modals ───────────────────────────────────────── */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.48);
      display:none;
      place-items:center;
      z-index:1000;
      padding:1.5rem;
      overscroll-behavior:contain;
    }
    .modal-backdrop[aria-hidden="false"]{display:grid;}
    .modal{
      background:var(--surface);
      border-radius:14px;
      max-width:620px;
      width:100%;
      max-height:92vh;
      overflow:auto;
      box-shadow:var(--shadow-md);
    }
    .modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:1.3rem 1.6rem;
      background:var(--accent);
      color:#fff;
    }
    .modal-header h2{margin:0;font-size:1.38rem;}
    .modal-close{
      background:none;
      border:none;
      color:#fff;
      font-size:2.1rem;
      line-height:1;
      cursor:pointer;
      padding:.2rem .5rem;
      border-radius:10px;
    }
    .modal-close:hover{background:rgba(255,255,255,.12);}
    .modal-close:focus-visible{
      outline:3px solid rgba(255,255,255,.65);
      outline-offset:2px;
    }

    form{padding:1.6rem;}
    label{
      display:block;
      margin:1.3rem 0 .45rem;
      font-weight:500;
      font-size:1.05rem;
    }
    input,select,textarea{
      display:block;
      width:100%;
      padding:.9rem 1.1rem;
      font:inherit;
      font-size:1.05rem;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
    }
    textarea{min-height:7.5rem;resize:vertical;}

    .form-footer{
      margin-top:1.8rem;
      text-align:right;
    }
    .form-footer .small-note{
      text-align:left;
      margin:0 0 1rem;
      font-size:.96rem;
      color:var(--text-sub);
    }

    .fallback-actions{
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
      margin-top:.9rem;
      align-items:center;
    }
    .status{
      margin:0;
      color:var(--text-sub);
      font-size:.96rem;
      line-height:1.4;
    }

    .sr-only{
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    @media (max-width:560px){
      .actions .btn{min-width:100%;}
      .btn,.pill{width:100%;}
      .fallback-actions{width:100%;}
      .logo{width:40px;height:40px;border-radius:10px;}
      .brand-title{font-size:1.25rem;}
    }

    @media (prefers-reduced-motion: reduce){
      html{scroll-behavior:auto;}
      *,*::before,*::after{transition:none !important;animation:none !important;}
    }
  </style>
</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="nav" role="banner">
    <div class="nav-inner container">
      <a href="#top" class="brand" aria-label="Manx Loss Support home">
        <img class="logo" src="logo.png" alt="Manx Loss Support logo" width="44" height="44" loading="eager" decoding="async">
        <span class="brand-text">
          <span class="brand-title">Manx Loss Support</span>
          <span class="brand-sub">Confidential Listening — Isle of Man</span>
        </span>
      </a>

      <nav class="nav-links" aria-label="Primary">
        <a href="#how">How it works</a>
        <a href="#contact">Contact</a>
        <a href="#donate">Donate</a>
        <button type="button" class="linkish" data-modal-open="privacy">Privacy &amp; confidentiality</button>
        <button type="button" class="btn" data-modal-open="support">Request Support</button>
      </nav>
    </div>
  </header>

  <main class="container" id="main">
    <div id="top"></div>

    <section class="hero" aria-labelledby="hero-title">
      <h1 id="hero-title">When loss hurts, we’re here to listen.</h1>

      <p class="lead">
        Free, confidential support for grief — pet loss, bereavement, separation or any heavy change.<br>
        No judgement, just a kind ear on the Isle of Man.
      </p>

      <p class="intro-nudge">
        <strong>Recommended:</strong> Start by writing using the form or email — it helps us respond thoughtfully.
      </p>
      <p class="phone-nudge">
        <strong>Phone support:</strong> We aim to keep the line available 24/7. If it’s busy, please leave a short message and a safe callback number — we’ll return your call as a priority.
      </p>

      <div class="actions" role="group" aria-label="Quick actions">
        <button type="button" class="btn" data-modal-open="support">Write to us (recommended)</button>
        <a href="mailto:hello@mls.im?subject=Support%20Enquiry" class="btn btn-outline">Email hello@mls.im</a>
        <a href="tel:0800000000" class="btn btn-outline" aria-label="Call freephone 0800 000 000">Call Freephone 0800 000 000</a>
      </div>

      <div class="alert" role="alert">
        <strong>In crisis?</strong> Call 999 (emergency) or Samaritans on <a href="tel:116123">116 123</a> right away.
      </div>
    </section>

    <section class="tiles" aria-label="Ways to reach us">
      <div class="tile">
        <h3>Start by writing</h3>
        <button type="button" class="pill" data-modal-open="support">Open Support Form</button>
        <p>Private, simple, easiest for us to reply carefully.</p>
        <p class="field-hint">No data is stored on this website.</p>
      </div>

      <div class="tile">
        <h3>Email us</h3>
        <a href="mailto:hello@mls.im?subject=Support%20Enquiry" class="pill">hello@mls.im</a>
        <p>Write as much or as little as you like. We’ll reply kindly.</p>
      </div>

      <div class="tile">
        <h3>Call us</h3>
        <a href="tel:0800000000" class="pill" aria-label="Call freephone 0800 000 000">0800 000 000</a>
        <p>If it’s busy, leave a message — we’ll call you back as a priority.</p>
      </div>
    </section>

    <section id="how" aria-labelledby="how-title">
      <h2 id="how-title" class="section-label">How we help</h2>
      <div class="grid-2-3">
        <div class="card">
          <h3>1. Reach out</h3>
          <p>Call, email or use the short form. Even “I’m struggling” is enough.</p>
        </div>
        <div class="card">
          <h3>2. We listen</h3>
          <p>Calm, caring conversation with trained volunteers. No pressure.</p>
        </div>
        <div class="card">
          <h3>3. Gentle next steps</h3>
          <p>If you’d like, we can suggest local Isle of Man support.</p>
        </div>
      </div>
    </section>

    <section id="contact" aria-labelledby="contact-title">
      <h2 id="contact-title" class="section-label">Get in touch today</h2>

      <div class="grid-2-3">
        <div class="card">
          <h3>Support Form (recommended)</h3>
          <p>Composes an email — private &amp; simple.</p>
          <button type="button" class="btn" data-modal-open="support" style="margin-top:1.2rem;width:100%;">Open Form</button>
          <p class="field-hint">This form opens your email app. Nothing is stored on this website.</p>
        </div>

        <div class="card">
          <h3>Direct contact</h3>
          <p style="margin-bottom:1rem;">
            Email: <a href="mailto:hello@mls.im?subject=Support%20Enquiry">hello@mls.im</a><br>
            Phone: <a href="tel:0800000000">0800 000 000</a>
          </p>

          <div class="callout" aria-label="Urgent help information">
            Urgent help: Samaritans <a href="tel:116123">116 123</a><br>
            Crisis Response &amp; Home Treatment Team <a href="tel:01624642860">01624 642860</a>
          </div>

          <p class="field-hint" style="margin-top:1rem;">
            If you are in immediate danger, call <a href="tel:999">999</a>.
          </p>
        </div>
      </div>
    </section>

    <section id="donate" aria-labelledby="donate-title">
      <h2 id="donate-title" class="section-label">Support MLS</h2>

      <div class="card" style="text-align:center;">
        <h3 class="donate-title">Help us help others</h3>
        <p style="font-size:1.18rem;color:var(--text-sub);margin:0;">
          Donations keep our service free for everyone on the Island.
        </p>

        <div class="actions" style="margin-top:1.6rem;">
          <button type="button" class="btn is-disabled" disabled aria-disabled="true" title="Donation link coming soon">
            Donate Online (coming soon)
          </button>
          <a href="mailto:hello@mls.im?subject=Donation%20Enquiry" class="btn btn-outline">Enquire about donating</a>
        </div>

        <p class="field-hint" style="max-width:44rem;margin:1rem auto 0;">
          If you’d like to support MLS, email us and we’ll reply with the easiest way to donate.
        </p>
      </div>
    </section>

    <!-- SUPPORT MODAL -->
    <div class="modal-backdrop" id="support-modal" aria-hidden="true" data-modal="support">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="support-heading" aria-describedby="support-desc">
        <div class="modal-header">
          <h2 id="support-heading">Request Support</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Close dialog">×</button>
        </div>

        <div class="sr-only" id="support-desc">
          Support request form. This composes an email on your device; no data is stored on this website.
        </div>

        <form id="support-form" novalidate>
          <label for="name">Your name <small>(optional)</small></label>
          <input id="name" autocomplete="name" placeholder="e.g. Margaret">

          <label for="reply-pref">Preferred way to reply</label>
          <select id="reply-pref" aria-describedby="pref-hint">
            <option value="Email" selected>Email</option>
            <option value="Phone call">Phone call</option>
            <option value="Either">Either</option>
          </select>
          <p class="field-hint" id="pref-hint">Choose what feels easiest. You can change your mind later.</p>

          <div id="email-field" class="field">
            <label for="email">Your email</label>
            <input id="email" type="email" autocomplete="email" placeholder="your@email.com" inputmode="email" aria-describedby="email-hint email-error">
            <p class="field-hint" id="email-hint">If you prefer a phone call, you can leave this blank and share a number instead.</p>
            <p class="error" id="email-error" role="status" aria-live="polite"></p>
          </div>

          <div id="phone-wrap" style="display:none;">
            <div id="phone-field" class="field">
              <label for="phone">Your phone number</label>
              <input id="phone" type="tel" autocomplete="tel" placeholder="e.g. 07624 123456" inputmode="tel" aria-describedby="phone-hint phone-error">
              <p class="field-hint" id="phone-hint">Only needed if you want us to call you.</p>
              <p class="error" id="phone-error" role="status" aria-live="polite"></p>
            </div>
          </div>

          <label for="topic">What kind of loss?</label>
          <select id="topic">
            <option>Pet loss</option>
            <option>Bereavement</option>
            <option>Relationship / separation</option>
            <option>Other</option>
          </select>

          <div id="message-field" class="field">
            <label for="message">Tell us a little (or a lot)</label>
            <textarea id="message" placeholder="I'm finding it hard after losing my dog..." aria-describedby="message-error"></textarea>
            <p class="error" id="message-error" role="status" aria-live="polite"></p>
          </div>

          <div class="form-footer">
            <p class="small-note">
              This composes an email on your device — nothing is stored on this website.
              <button type="button" class="linkish" data-modal-open="privacy">Read privacy &amp; confidentiality</button>
            </p>
            <button type="submit" class="btn">Compose email message</button>
          </div>

          <div id="mailto-fallback" class="callout" style="display:none;margin:1.2rem 0 0;">
            <strong>Having trouble?</strong><br>
            If nothing opened, your device may not have an email app set up.<br>
            Email us at <a href="mailto:hello@mls.im?subject=Support%20Enquiry">hello@mls.im</a> and copy/paste from below:

            <div style="margin-top:.8rem;">
              <label for="fallback-text" class="sr-only">Copyable message</label>
              <textarea id="fallback-text" readonly aria-readonly="true"></textarea>

              <div class="fallback-actions">
                <button type="button" class="btn btn-outline" id="copy-fallback">Copy message</button>
                <p class="status" id="copy-status" aria-live="polite"></p>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- PRIVACY MODAL -->
    <div class="modal-backdrop" id="privacy-modal" aria-hidden="true" data-modal="privacy">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="privacy-heading">
        <div class="modal-header">
          <h2 id="privacy-heading">Privacy &amp; confidentiality</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Close dialog">×</button>
        </div>

        <div style="padding:1.6rem;font-size:1.05rem;line-height:1.68;">
          <p><strong>Your privacy matters.</strong></p>
          <p><strong>Website:</strong> No personal information is stored. No cookies, no tracking, no analytics.</p>
          <p><strong>Support form:</strong> Opens your own email client. Nothing is sent to or kept on this site.</p>
          <p><strong>Email &amp; phone:</strong> Treated as confidential; used only to provide support. No marketing, no selling of data.</p>
          <p><strong>Safety:</strong> If you are in immediate danger call 999. Samaritans: <a href="tel:116123">116 123</a>.</p>
          <p class="field-hint" style="margin-top:1.4rem;">
            Note: Your email provider may keep copies in Sent items / on servers as part of normal delivery.
          </p>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>
        Manx Loss Support (MLS) — Confidential listening for grief on the Isle of Man.<br>
        <strong>Not emergency care:</strong> Call 999 or Samaritans 116 123 if in immediate danger.
      </p>

      <p style="margin-top:1.4rem;">
        <a href="mailto:hello@mls.im?subject=Support%20Enquiry">hello@mls.im</a>  •  <a href="tel:0800000000">0800 000 000</a><br>
        <button type="button" class="linkish" data-modal-open="privacy">Privacy &amp; confidentiality</button><br>
        © <span id="copyright-year"></span>
      </p>
    </div>
  </footer>

  <script>
    // MLS single-file JS — Feb 2026
    // Defensive by design: content renders even if JS fails.

    (function () {
      const $  = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

      const yearEl = $('#copyright-year');
      if (yearEl) yearEl.textContent = String(new Date().getFullYear());

      const modals = {
        support: $('#support-modal'),
        privacy: $('#privacy-modal')
      };

      const body = document.body;
      let lastTrigger = null;

      const focusableSelector = [
        'a[href]',
        'button:not([disabled])',
        'input:not([disabled])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      const isOpen = (m) => m && m.getAttribute('aria-hidden') === 'false';

      function setOpen(m, open) {
        if (!m) return;
        m.setAttribute('aria-hidden', open ? 'false' : 'true');
        body.style.overflow = open ? 'hidden' : '';
      }

      function closeAll() {
        Object.values(modals).forEach(m => setOpen(m, false));
        if (lastTrigger && typeof lastTrigger.focus === 'function') lastTrigger.focus();
        lastTrigger = null;
      }

      function openModal(name, triggerEl) {
        const m = modals[name];
        if (!m) return;

        lastTrigger = triggerEl || document.activeElement;

        Object.entries(modals).forEach(([k, other]) => {
          if (k !== name) setOpen(other, false);
        });

        setOpen(m, true);

        const first = $(focusableSelector, m);
        if (first) first.focus();
      }

      // Triggers
      $$('[data-modal-open]').forEach(el => {
        el.addEventListener('click', (e) => {
          e.preventDefault();
          openModal(el.getAttribute('data-modal-open'), el);
        });
      });

      // Backdrop click closes
      Object.values(modals).forEach(m => {
        if (!m) return;
        m.addEventListener('mousedown', (e) => {
          if (e.target === m) closeAll();
        });
      });

      // Close buttons
      $$('[data-modal-close]').forEach(btn => {
        btn.addEventListener('click', () => closeAll());
      });

      // Escape closes
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeAll();
      });

      // Focus trap
      window.addEventListener('keydown', (e) => {
        if (e.key !== 'Tab') return;
        const openM = Object.values(modals).find(isOpen);
        if (!openM) return;

        const focusables = $$(focusableSelector, openM).filter(el => el.offsetParent !== null);
        if (!focusables.length) return;

        const first = focusables[0];
        const last = focusables[focusables.length - 1];

        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault(); last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault(); first.focus();
        }
      });

      // bfcache resilience (Safari/back-forward cache)
      window.addEventListener('pageshow', () => closeAll());

      // ── Support form logic ────────────────────────────────
      const form = $('#support-form');
      if (!form) return;

      const pref = $('#reply-pref');
      const phoneWrap = $('#phone-wrap');
      const emailInput = $('#email');
      const phoneInput = $('#phone');
      const messageInput = $('#message');

      const emailField = $('#email-field');
      const phoneField = $('#phone-field');
      const messageField = $('#message-field');

      const emailError = $('#email-error');
      const phoneError = $('#phone-error');
      const messageError = $('#message-error');

      const fallbackBox = $('#mailto-fallback');
      const fallbackTxt = $('#fallback-text');
      const copyBtn = $('#copy-fallback');
      const copyStatus = $('#copy-status');

      function clearFieldError(fieldEl, errorEl, inputEl) {
        if (fieldEl) fieldEl.classList.remove('has-error');
        if (errorEl) errorEl.textContent = '';
        if (inputEl) inputEl.removeAttribute('aria-invalid');
      }

      function setFieldError(fieldEl, errorEl, inputEl, msg) {
        if (fieldEl) fieldEl.classList.add('has-error');
        if (errorEl) errorEl.textContent = msg || 'Please check this field.';
        if (inputEl) inputEl.setAttribute('aria-invalid', 'true');
      }

      function resetAllErrors() {
        clearFieldError(emailField, emailError, emailInput);
        clearFieldError(phoneField, phoneError, phoneInput);
        clearFieldError(messageField, messageError, messageInput);
      }

      function setContactUI() {
        if (!pref || !phoneWrap || !emailInput || !phoneInput) return;

        const choice = pref.value;
        const showPhone = (choice === 'Phone call' || choice === 'Either');
        phoneWrap.style.display = showPhone ? '' : 'none';

        emailInput.required = (choice === 'Email');
        phoneInput.required = (choice === 'Phone call');

        emailInput.setCustomValidity('');
        phoneInput.setCustomValidity('');
        clearFieldError(emailField, emailError, emailInput);
        clearFieldError(phoneField, phoneError, phoneInput);
      }

      if (pref) pref.addEventListener('change', () => setContactUI());
      setContactUI();

      function buildMessage() {
        const name = ($('#name')?.value || '').trim();
        const email = (emailInput?.value || '').trim();
        const phone = (phoneInput?.value || '').trim();
        const topic = $('#topic')?.value || 'Support';
        const choice = pref?.value || 'Email';
        const message = (messageInput?.value || '').trim();

        const subject = `MLS Support Request — ${topic}`;

        let body = `Hello,\n\n`;
        body += `Topic: ${topic}\n`;
        body += `Preferred contact: ${choice}\n`;
        if (name) body += `Name: ${name}\n`;
        if (email) body += `Email: ${email}\n`;
        if (phone) body += `Phone: ${phone}\n`;
        body += `\nMessage:\n${message || '(no details provided)'}\n\nThank you.`;

        return { subject, body };
      }

      function validateForm() {
        resetAllErrors();

        const choice = pref?.value || 'Email';
        const email = (emailInput?.value || '').trim();
        const phone = (phoneInput?.value || '').trim();
        const msg = (messageInput?.value || '').trim();

        if (!msg) {
          setFieldError(
            messageField, messageError, messageInput,
            'If you can, add one or two lines — even “I’m struggling” is enough.'
          );
          return { ok:false, focusEl: messageInput };
        }

        if (choice === 'Email') {
          if (!email) {
            setFieldError(emailField, emailError, emailInput, 'Please add an email address so we can reply.');
            return { ok:false, focusEl: emailInput };
          }
          if (emailInput && !emailInput.checkValidity()) {
            setFieldError(emailField, emailError, emailInput, 'That email address doesn’t look quite right.');
            return { ok:false, focusEl: emailInput };
          }
        }

        if (choice === 'Phone call') {
          if (!phone) {
            setFieldError(phoneField, phoneError, phoneInput, 'Please add a phone number so we can call you back.');
            return { ok:false, focusEl: phoneInput };
          }
        }

        if (choice === 'Either') {
          if (!email && !phone) {
            setFieldError(emailField, emailError, emailInput, 'Please provide an email address or a phone number.');
            return { ok:false, focusEl: emailInput };
          }
          if (email && emailInput && !emailInput.checkValidity()) {
            setFieldError(emailField, emailError, emailInput, 'That email address doesn’t look quite right.');
            return { ok:false, focusEl: emailInput };
          }
        }

        return { ok:true };
      }

      function showFallback(subject, body) {
        if (!fallbackBox || !fallbackTxt) return;
        fallbackTxt.value = `Subject: ${subject}\n\n${body}`;
        fallbackBox.style.display = '';
        if (copyStatus) copyStatus.textContent = '';
      }

      async function copyTextToClipboard(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
          return true;
        }
        const temp = document.createElement('textarea');
        temp.value = text;
        temp.setAttribute('readonly', '');
        temp.style.position = 'absolute';
        temp.style.left = '-9999px';
        document.body.appendChild(temp);
        temp.select();
        try {
          const ok = document.execCommand('copy');
          document.body.removeChild(temp);
          return ok;
        } catch {
          document.body.removeChild(temp);
          return false;
        }
      }

      if (copyBtn) {
        copyBtn.addEventListener('click', async () => {
          if (!fallbackTxt) return;
          const ok = await copyTextToClipboard(fallbackTxt.value || '');
          if (copyStatus) copyStatus.textContent = ok ? 'Copied.' : 'Could not copy automatically — you can select and copy manually.';
        });
      }

      if (messageInput) {
        messageInput.addEventListener('input', () => {
          const msg = (messageInput.value || '').trim();
          if (msg.length > 0) clearFieldError(messageField, messageError, messageInput);
        });
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        if (fallbackBox) fallbackBox.style.display = 'none';
        if (fallbackTxt) fallbackTxt.value = '';
        if (copyStatus) copyStatus.textContent = '';

        const result = validateForm();
        if (!result.ok) {
          result.focusEl?.focus?.();
          return;
        }

        const { subject, body } = buildMessage();
        const mailto = `mailto:hello@mls.im?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

        window.location.href = mailto;

        // Can't detect mail client success; show fallback if user remains in modal.
        window.setTimeout(() => {
          if (isOpen(modals.support)) showFallback(subject, body);
        }, 900);
      });
    })();
  </script>
</body>
</html>
```



